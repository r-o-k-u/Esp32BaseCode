<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 DualComm System - Sensor Monitoring</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ESP32 DualComm System</h1>
            <h2>Sensor Monitoring Center</h2>
        </header>
        
        <nav>
            <a href="index.html" onclick="onTabChange('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="sensors.html" class="active" onclick="onTabChange('sensors')"><i class="fas fa-thermometer-half"></i> Sensors</a>
            <a href="actuators.html" onclick="onTabChange('actuators')"><i class="fas fa-cogs"></i> Actuators</a>
            <a href="communication.html" onclick="onTabChange('communication')"><i class="fas fa-satellite-dish"></i> Communication</a>
            <a href="wifi.html" onclick="onTabChange('wifi')"><i class="fas fa-wifi"></i> WiFi Manager</a>
            <a href="ota.html" onclick="onTabChange('ota')"><i class="fas fa-upload"></i> OTA Updates</a>
            <a href="logs.html" onclick="onTabChange('logs')"><i class="fas fa-clipboard-list"></i> Logs</a>
            <a href="config.html" onclick="onTabChange('config')"><i class="fas fa-sliders-h"></i> Configuration</a>
        </nav>

        <div class="controls">
            <button class="btn-primary" onclick="refreshAllData()">
                <i class="fas fa-sync-alt"></i> Refresh All
            </button>
            <button class="btn-success" onclick="refreshSensors()">
                <i class="fas fa-sync"></i> Refresh Sensors
            </button>
            <button class="btn-info" onclick="exportSensorData()">
                <i class="fas fa-download"></i> Export Data
            </button>
            <button class="btn-danger" onclick="emergencyStop()">
                <i class="fas fa-skull-crossbones"></i> Emergency Stop
            </button>
            
            <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-left: auto;">
                <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                    <div class="switch">
                        <input type="checkbox" id="autoRefresh" checked>
                        <span class="slider"></span>
                    </div>
                    <span style="font-size: 0.875rem;">Auto Refresh</span>
                </label>
                
                <div style="display: flex; gap: var(--spacing-sm);">
                    <button class="btn-small btn-secondary" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn-small btn-secondary" onclick="restartDevice()">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sensor Statistics Overview -->
        <div class="stats-grid">
            <div class="stat-card fade-in" style="animation-delay: 0ms">
                <h4>Active Sensors</h4>
                <div class="stat-value" id="active-sensors-count">0</div>
                <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
                    <span class="label">Total:</span>
                    <span class="value" id="total-sensors">0</span>
                </div>
            </div>
            
            <div class="stat-card fade-in" style="animation-delay: 100ms">
                <h4>Sensor Health</h4>
                <div class="stat-value" id="sensor-health">--%</div>
                <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
                    <span class="label">Last Update:</span>
                    <span class="value" id="last-sensor-update">--</span>
                </div>
            </div>
            
            <div class="stat-card fade-in" style="animation-delay: 200ms">
                <h4>Environment</h4>
                <div class="stat-value" id="current-temp">--¬∞C</div>
                <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
                    <span class="label">Humidity:</span>
                    <span class="value" id="current-humidity">--%</span>
                </div>
            </div>
            
            <div class="stat-card fade-in" style="animation-delay: 300ms">
                <h4>Data Points</h4>
                <div class="stat-value" id="data-points">0</div>
                <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
                    <span class="label">Since:</span>
                    <span class="value" id="monitoring-since">--</span>
                </div>
            </div>
        </div>

        <main>
            <!-- Real-time Sensor Grid -->
            <div class="sensor-grid">
                <!-- Temperature & Humidity -->
                <div class="sensor-card fade-in" style="animation-delay: 0ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-thermometer-half" style="color: #FF6384;"></i> Temperature & Humidity</h3>
                        <div class="sensor-status" id="dht-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Temperature:</span>
                            <span class="value" id="temperature-value">-- ¬∞C</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Humidity:</span>
                            <span class="value" id="humidity-value">-- %</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Heat Index:</span>
                            <span class="value" id="heat-index">-- ¬∞C</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Comfort:</span>
                            <span class="value" id="comfort-level">--</span>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-secondary" onclick="calibrateSensor('dht')">
                            <i class="fas fa-sliders-h"></i> Calibrate
                        </button>
                        <button class="btn-small btn-info" onclick="refreshSensor('dht')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Pressure & Altitude -->
                <div class="sensor-card fade-in" style="animation-delay: 50ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-tachometer-alt" style="color: #36A2EB;"></i> Pressure & Altitude</h3>
                        <div class="sensor-status" id="bmp-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Pressure:</span>
                            <span class="value" id="pressure-value">-- hPa</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Altitude:</span>
                            <span class="value" id="altitude-value">-- m</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Sea Level:</span>
                            <span class="value" id="sea-level">-- hPa</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Trend:</span>
                            <span class="value" id="pressure-trend">--</span>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-secondary" onclick="calibrateSensor('bmp')">
                            <i class="fas fa-sliders-h"></i> Calibrate
                        </button>
                        <button class="btn-small btn-info" onclick="refreshSensor('bmp')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Light Detection -->
                <div class="sensor-card fade-in" style="animation-delay: 100ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-lightbulb" style="color: #FFCE56;"></i> Light Detection</h3>
                        <div class="sensor-status" id="light-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Light Level:</span>
                            <span class="value" id="light-level">-- lux</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Light State:</span>
                            <span class="value" id="light-state">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">ADC Value:</span>
                            <span class="value" id="light-adc">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Brightness:</span>
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                <div id="light-bar" style="flex: 1; height: 6px; background: var(--glass-border); border-radius: var(--radius-full); overflow: hidden;">
                                    <div id="light-fill" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--warning), var(--accent)); transition: width 0.3s ease;"></div>
                                </div>
                                <span id="light-percentage" style="font-size: 0.875rem;">0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-info" onclick="refreshSensor('light')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                </div>

                <!-- Motion Detection -->
                <div class="sensor-card fade-in" style="animation-delay: 150ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-running" style="color: #FF6384;"></i> Motion Detection</h3>
                        <div class="sensor-status" id="motion-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Motion State:</span>
                            <span class="value" id="motion-state">Inactive</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Last Trigger:</span>
                            <span class="value" id="last-motion">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Trigger Count:</span>
                            <span class="value" id="motion-count">0</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Sensitivity:</span>
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                <input type="range" id="motion-sensitivity" min="1" max="10" value="5" 
                                       style="flex: 1;" onchange="updateMotionSensitivity(this.value)">
                                <span id="sensitivity-value" style="font-size: 0.875rem;">5</span>
                            </div>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-info" onclick="refreshSensor('motion')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn-small btn-warning" onclick="resetMotionCount()">
                            <i class="fas fa-redo"></i> Reset Count
                        </button>
                    </div>
                </div>

                <!-- Distance Measurement -->
                <div class="sensor-card fade-in" style="animation-delay: 200ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-ruler" style="color: #4BC0C0;"></i> Distance Measurement</h3>
                        <div class="sensor-status" id="distance-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Distance:</span>
                            <span class="value" id="distance-value">-- cm</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Object Status:</span>
                            <span class="value" id="object-status">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Max Range:</span>
                            <span class="value" id="max-range">400 cm</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Accuracy:</span>
                            <span class="value" id="distance-accuracy">¬± 0.3 cm</span>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-info" onclick="refreshSensor('distance')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn-small btn-secondary" onclick="calibrateSensor('ultrasonic')">
                            <i class="fas fa-ruler-combined"></i> Calibrate
                        </button>
                    </div>
                </div>

                <!-- Air Quality -->
                <div class="sensor-card fade-in" style="animation-delay: 250ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-wind" style="color: #9966FF;"></i> Air Quality</h3>
                        <div class="sensor-status" id="air-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">PPM Value:</span>
                            <span class="value" id="air-ppm">-- ppm</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Air Quality:</span>
                            <span class="value" id="air-quality">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">ADC Reading:</span>
                            <span class="value" id="air-adc">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Calibration:</span>
                            <span class="value" id="air-calibration">Clean Air</span>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-info" onclick="refreshSensor('air')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn-small btn-warning" onclick="calibrateAirSensor()">
                            <i class="fas fa-wind"></i> Re-calibrate
                        </button>
                    </div>
                </div>

                <!-- Soil Moisture -->
                <div class="sensor-card fade-in" style="animation-delay: 300ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-seedling" style="color: #00CC66;"></i> Soil Moisture</h3>
                        <div class="sensor-status" id="soil-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Moisture Level:</span>
                            <span class="value" id="soil-moisture">-- %</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Soil Condition:</span>
                            <span class="value" id="soil-condition">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">ADC Value:</span>
                            <span class="value" id="soil-adc">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Irrigation:</span>
                            <span class="value" id="irrigation-status">--</span>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-info" onclick="refreshSensor('soil')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn-small btn-secondary" onclick="calibrateSensor('soil')">
                            <i class="fas fa-sliders-h"></i> Calibrate
                        </button>
                    </div>
                </div>

                <!-- IMU (Motion & Orientation) -->
                <div class="sensor-card fade-in" style="animation-delay: 350ms">
                    <div class="sensor-header">
                        <h3><i class="fas fa-compass" style="color: #FF9F40;"></i> IMU - Motion & Orientation</h3>
                        <div class="sensor-status" id="imu-status">Offline</div>
                    </div>
                    <div class="sensor-data">
                        <div class="data-item">
                            <span class="label">Acceleration:</span>
                            <span class="value" id="acceleration-value">-- g</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Gyroscope:</span>
                            <span class="value" id="gyroscope-value">-- ¬∞/s</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Orientation:</span>
                            <span class="value" id="orientation-value">--</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Temperature:</span>
                            <span class="value" id="imu-temperature">-- ¬∞C</span>
                        </div>
                    </div>
                    <div class="sensor-actions">
                        <button class="btn-small btn-info" onclick="refreshSensor('imu')">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn-small btn-secondary" onclick="calibrateSensor('imu')">
                            <i class="fas fa-sliders-h"></i> Calibrate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="card fade-in" style="animation-delay: 400ms; margin-top: var(--spacing-xl);">
                <div class="card-header">
                    <h2><i class="fas fa-chart-line"></i> Real-time Sensor Charts</h2>
                    <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                        <select id="chart-sensor" class="btn-small" style="min-width: 150px;">
                            <option value="temperature">üå°Ô∏è Temperature</option>
                            <option value="humidity">üíß Humidity</option>
                            <option value="pressure">üèîÔ∏è Pressure</option>
                            <option value="light">üí° Light Level</option>
                            <option value="distance">üìè Distance</option>
                            <option value="air">üå¨Ô∏è Air Quality</option>
                            <option value="moisture">üíß Soil Moisture</option>
                        </select>
                        <select id="chart-duration" class="btn-small" style="min-width: 150px;">
                            <option value="60">Last 1 Minute</option>
                            <option value="300" selected>Last 5 Minutes</option>
                            <option value="1800">Last 30 Minutes</option>
                            <option value="3600">Last 1 Hour</option>
                            <option value="14400">Last 4 Hours</option>
                        </select>
                        <button class="btn-small btn-info" onclick="updateChart()">
                            <i class="fas fa-sync"></i> Update Chart
                        </button>
                        <button class="btn-small btn-warning" onclick="clearChart()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button class="btn-small btn-success" onclick="exportChart()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="sensorChart"></canvas>
                </div>
            </div>

            <!-- Sensor Alerts & Notifications -->
            <div class="card fade-in" style="animation-delay: 450ms; margin-top: var(--spacing-xl);">
                <div class="card-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Sensor Alerts & Notifications</h2>
                    <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                        <button class="btn-small btn-danger" onclick="clearAllAlerts()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                        <button class="btn-small btn-warning" onclick="testAlerts()">
                            <i class="fas fa-bell"></i> Test Alerts
                        </button>
                        <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
                            <div class="switch">
                                <input type="checkbox" id="enable-alerts" checked>
                                <span class="slider"></span>
                            </div>
                            <span style="font-size: 0.875rem;">Enable Alerts</span>
                        </label>
                    </div>
                </div>
                <div id="alerts-container" style="padding: var(--spacing-lg); max-height: 400px; overflow-y: auto;">
                    <div id="alerts-list" class="alerts-list">
                        <div class="alert-item info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Sensor monitoring initialized</strong>
                                <p>All sensors are ready for monitoring. Alerts will appear here.</p>
                            </div>
                            <span class="alert-time">Just now</span>
                        </div>
                    </div>
                    
                    <!-- Alert Configuration -->
                    <div style="margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 1px solid var(--glass-border);">
                        <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary);">
                            <i class="fas fa-cog"></i> Alert Configuration
                        </h3>
                        <div class="sensor-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                            <div class="data-item">
                                <span class="label">Temperature Alert:</span>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <input type="number" id="temp-alert-min" placeholder="Min" value="10" style="width: 80px;">
                                    <span>to</span>
                                    <input type="number" id="temp-alert-max" placeholder="Max" value="35" style="width: 80px;">
                                    <span>¬∞C</span>
                                </div>
                            </div>
                            <div class="data-item">
                                <span class="label">Humidity Alert:</span>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <input type="number" id="humidity-alert-min" placeholder="Min" value="30" style="width: 80px;">
                                    <span>to</span>
                                    <input type="number" id="humidity-alert-max" placeholder="Max" value="70" style="width: 80px;">
                                    <span>%</span>
                                </div>
                            </div>
                            <div class="data-item">
                                <span class="label">Light Threshold:</span>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <input type="number" id="light-threshold" placeholder="Threshold" value="500" style="width: 100px;">
                                    <span>lux</span>
                                </div>
                            </div>
                            <div class="data-item">
                                <span class="label">Air Quality Alert:</span>
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <input type="number" id="air-alert-threshold" placeholder="Threshold" value="1000" style="width: 100px;">
                                    <span>ppm</span>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: var(--spacing-lg);">
                            <button class="btn-primary" onclick="saveAlertConfig()">
                                <i class="fas fa-save"></i> Save Alert Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sensor Log -->
            <div class="card fade-in" style="animation-delay: 500ms; margin-top: var(--spacing-xl);">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> Sensor Data Log</h2>
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <button class="btn-small btn-info" onclick="refreshSensorLog()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn-small btn-danger" onclick="clearSensorLog()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button class="btn-small btn-success" onclick="exportSensorLog()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                <div id="sensor-log" class="log-container" style="height: 300px;">
                    <div class="log-entry info">
                        <span class="log-time">00:00:00</span>
                        <span class="log-message">Sensor monitoring system started</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Footer -->
        <footer style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: var(--glass-bg); 
                     border-radius: var(--radius-lg); border: 1px solid var(--glass-border);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                    <div id="status-indicator" class="status-indicator offline">
                        <span id="connection-status">Disconnected</span>
                    </div>
                    <div style="font-family: var(--font-mono); font-size: 0.875rem; color: var(--text-muted);">
                        <span>Last Sensor Update: </span>
                        <span id="sensor-update-time">--</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                    <span style="font-size: 0.875rem; color: var(--text-muted);">
                        <i class="fas fa-microchip"></i> Active Sensors: <span id="active-sensors">0/8</span>
                    </span>
                    <span style="font-size: 0.875rem; color: var(--text-muted);">
                        <i class="fas fa-chart-line"></i> Data Points: <span id="data-points-count">0</span>
                    </span>
                    <span style="font-size: 0.875rem; color: var(--text-muted);">
                        <i class="fas fa-bell"></i> Alerts: <span id="active-alerts">0</span>
                    </span>
                </div>
                
                <div>
                    <button class="btn-small btn-secondary" onclick="connectWebSocket()">
                        <i class="fas fa-plug"></i> Reconnect
                    </button>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <script>
        // Sensor-specific functions
        let sensorChart = null;
        let chartData = [];
        let chartLabels = [];
        let sensorMonitoringActive = true;
        
        function initializeSensorCharts() {
            const ctx = document.getElementById('sensorChart').getContext('2d');
            sensorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Sensor Data',
                        data: chartData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#4CAF50',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: {
                                    family: "'Rajdhani', sans-serif"
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b8c5d6',
                                font: {
                                    family: "'JetBrains Mono', monospace"
                                }
                            }
                        },
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#b8c5d6',
                                font: {
                                    family: "'JetBrains Mono', monospace"
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateChart() {
            const sensorType = document.getElementById('chart-sensor').value;
            const duration = parseInt(document.getElementById('chart-duration').value);
            
            if (!sensorChart) {
                initializeSensorCharts();
            }
            
            // Update chart title based on sensor selection
            const sensorNames = {
                'temperature': 'Temperature (¬∞C)',
                'humidity': 'Humidity (%)',
                'pressure': 'Pressure (hPa)',
                'light': 'Light Level (lux)',
                'distance': 'Distance (cm)',
                'air': 'Air Quality (ppm)',
                'moisture': 'Soil Moisture (%)'
            };
            
            sensorChart.data.datasets[0].label = sensorNames[sensorType] || 'Sensor Data';
            sensorChart.update();
            
            showToast('Chart updated', 'success');
        }
        
        function clearChart() {
            if (sensorChart) {
                sensorChart.data.labels = [];
                sensorChart.data.datasets[0].data = [];
                sensorChart.update();
                showToast('Chart cleared', 'info');
            }
        }
        
        function exportChart() {
            if (!sensorChart) {
                showToast('No chart data to export', 'warning');
                return;
            }
            
            const link = document.createElement('a');
            link.download = 'sensor_chart.png';
            link.href = document.getElementById('sensorChart').toDataURL('image/png');
            link.click();
            showToast('Chart exported as PNG', 'success');
        }
        
        function calibrateSensor(sensorType) {
            if (!confirm(`Calibrate ${sensorType.toUpperCase()} sensor?`)) return;
            
            showToast(`Calibrating ${sensorType} sensor...`, 'info');
            addActivityLog(`Started calibration for ${sensorType} sensor`);
            
            // Send calibration command
            if (ws && ws.readyState === WebSocket.OPEN) {
                sendWSMessage({
                    type: 'calibrate',
                    sensor: sensorType
                });
            }
        }
        
        function calibrateAirSensor() {
            if (!confirm('Calibrate air quality sensor in clean air environment?')) return;
            
            showToast('Calibrating air quality sensor...', 'info');
            addActivityLog('Started air quality sensor calibration');
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                sendWSMessage({
                    type: 'calibrate',
                    sensor: 'air'
                });
            }
        }
        
        function refreshSensor(sensorType) {
            showToast(`Refreshing ${sensorType} sensor...`, 'info');
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                sendWSMessage({
                    type: 'getSensorData',
                    sensor: sensorType
                });
            }
        }
        
        function updateMotionSensitivity(value) {
            document.getElementById('sensitivity-value').textContent = value;
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                sendWSMessage({
                    type: 'setConfig',
                    config: 'motion_sensitivity',
                    value: parseInt(value)
                });
            }
        }
        
        function resetMotionCount() {
            if (!confirm('Reset motion detection count?')) return;
            
            document.getElementById('motion-count').textContent = '0';
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                sendWSMessage({
                    type: 'resetCounter',
                    counter: 'motion'
                });
            }
            
            showToast('Motion count reset', 'success');
            addActivityLog('Reset motion detection count');
        }
        
        function exportSensorData() {
            const data = {
                timestamp: new Date().toISOString(),
                sensors: {}
            };
            
            // Collect all sensor data
            const sensorElements = document.querySelectorAll('.sensor-card');
            sensorElements.forEach(card => {
                const sensorName = card.querySelector('h3').textContent.trim();
                const sensorData = {};
                
                card.querySelectorAll('.data-item').forEach(item => {
                    const label = item.querySelector('.label').textContent.trim().replace(':', '');
                    const value = item.querySelector('.value').textContent.trim();
                    sensorData[label] = value;
                });
                
                data.sensors[sensorName] = sensorData;
            });
            
            // Export as JSON
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sensor_data_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showToast('Sensor data exported', 'success');
            addActivityLog('Exported sensor data');
        }
        
        function exportSensorLog() {
            const logEntries = Array.from(document.querySelectorAll('#sensor-log .log-entry')).map(entry => ({
                time: entry.querySelector('.log-time').textContent,
                message: entry.querySelector('.log-message').textContent,
                type: entry.classList.contains('error') ? 'error' : 
                      entry.classList.contains('warning') ? 'warning' : 
                      entry.classList.contains('info') ? 'info' : 'debug'
            }));
            
            const data = {
                timestamp: new Date().toISOString(),
                totalEntries: logEntries.length,
                entries: logEntries
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sensor_log_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showToast('Sensor log exported', 'success');
        }
        
        function clearSensorLog() {
            if (!confirm('Clear all sensor log entries?')) return;
            
            document.getElementById('sensor-log').innerHTML = `
                <div class="log-entry info">
                    <span class="log-time">${new Date().toLocaleTimeString()}</span>
                    <span class="log-message">Sensor log cleared</span>
                </div>
            `;
            
            showToast('Sensor log cleared', 'info');
            addActivityLog('Cleared sensor log');
        }
        
        function refreshSensorLog() {
            // Add a new log entry
            const logContainer = document.getElementById('sensor-log');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry info';
            logEntry.innerHTML = `
                <span class="log-time">${new Date().toLocaleTimeString()}</span>
                <span class="log-message">Sensor log refreshed</span>
            `;
            
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }
        
        function clearAllAlerts() {
            if (!confirm('Clear all sensor alerts?')) return;
            
            document.getElementById('alerts-list').innerHTML = `
                <div class="alert-item info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Alerts cleared</strong>
                        <p>All sensor alerts have been cleared.</p>
                    </div>
                    <span class="alert-time">Just now</span>
                </div>
            `;
            
            document.getElementById('active-alerts').textContent = '0';
            showToast('All alerts cleared', 'info');
            addActivityLog('Cleared all sensor alerts');
        }
        
        function testAlerts() {
            const alertsList = document.getElementById('alerts-list');
            const testAlert = document.createElement('div');
            testAlert.className = 'alert-item warning';
            testAlert.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Test Alert</strong>
                    <p>This is a test alert to verify the alert system is working correctly.</p>
                </div>
                <span class="alert-time">${new Date().toLocaleTimeString()}</span>
            `;
            
            alertsList.insertBefore(testAlert, alertsList.firstChild);
            
            // Update alert count
            const alertCount = document.getElementById('active-alerts');
            alertCount.textContent = parseInt(alertCount.textContent) + 1;
            
            showToast('Test alert generated', 'warning');
        }
        
        function saveAlertConfig() {
            const config = {
                tempMin: document.getElementById('temp-alert-min').value,
                tempMax: document.getElementById('temp-alert-max').value,
                humidityMin: document.getElementById('humidity-alert-min').value,
                humidityMax: document.getElementById('humidity-alert-max').value,
                lightThreshold: document.getElementById('light-threshold').value,
                airThreshold: document.getElementById('air-alert-threshold').value
            };
            
            localStorage.setItem('sensorAlertConfig', JSON.stringify(config));
            
            showToast('Alert configuration saved', 'success');
            addActivityLog('Saved sensor alert configuration');
        }
        
        function loadAlertConfig() {
            const savedConfig = localStorage.getItem('sensorAlertConfig');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                document.getElementById('temp-alert-min').value = config.tempMin || 10;
                document.getElementById('temp-alert-max').value = config.tempMax || 35;
                document.getElementById('humidity-alert-min').value = config.humidityMin || 30;
                document.getElementById('humidity-alert-max').value = config.humidityMax || 70;
                document.getElementById('light-threshold').value = config.lightThreshold || 500;
                document.getElementById('air-alert-threshold').value = config.airThreshold || 1000;
            }
        }
        
        // Initialize sensors page
        document.addEventListener('DOMContentLoaded', function() {
            initializeSensorCharts();
            loadAlertConfig();
            
            // Initialize auto-refresh
            const autoRefreshToggle = document.getElementById('autoRefresh');
            if (autoRefreshToggle) {
                autoRefreshToggle.addEventListener('change', function() {
                    sensorMonitoringActive = this.checked;
                    if (this.checked) {
                        showToast('Auto-refresh enabled', 'success');
                    } else {
                        showToast('Auto-refresh disabled', 'warning');
                    }
                });
            }
            
            // Initialize alerts toggle
            const alertsToggle = document.getElementById('enable-alerts');
            if (alertsToggle) {
                alertsToggle.addEventListener('change', function() {
                    showToast(`Alerts ${this.checked ? 'enabled' : 'disabled'}`, 'info');
                });
            }
            
            // Initialize activity log
            addActivityLog('Sensor monitoring module loaded');
            addActivityLog('Real-time charts initialized');
        });
        
        // Auto-refresh sensors every 5 seconds if enabled
        setInterval(() => {
            if (sensorMonitoringActive && ws && ws.readyState === WebSocket.OPEN) {
                sendWSMessage({ type: 'getSensorData' });
            }
        }, 5000);
    </script>

    <!-- Include the main JavaScript file -->
    <script src="script.js"></script>
</body>
</html>